function Product(req){this.pArr=[];this.poArr=[];this.pmiArr=[];this.basketArr=[];this.quantity_max=0;this.quantity=1;this.join_type=false;this.sessid=req.sessid;this.tempkey=req.tempkey;this.vdate=req.vdate;this.pridx=0;this.device=req.device;this.staff_yn=req.staff_yn;this.cooper_yn=req.cooper_yn;this.productLayer=function(productcode){};this.comma=function(srcNumber){if(srcNumber==null)return 0;var txtNumber=srcNumber.toString();if(!isNaN(txtNumber)&&txtNumber!=""){var rxSplit=new RegExp('([0-9])([0-9][0-9][0-9][,.])');var arrNumber=txtNumber.split('.');arrNumber[0]+='.';do{arrNumber[0]=arrNumber[0].replace(rxSplit,'$1,$2');}while(rxSplit.test(arrNumber[0]));if(arrNumber.length>1)return arrNumber.join('');else
return arrNumber[0].split('.')[0];}};this.getProduct=function(prodcode,productcode,gubun){var ret='';var data='';if(prodcode||prodcode!=''){data=db.getDBFunc({sp_name:'product_detail',sp_param:prodcode});}else{data=db.getDBFunc({sp_name:'product_detail2',sp_param:productcode});}if(data.data){pArr=data.data;for(var i=0;i<pArr.length;i++){if(productcode == pArr[i].productcode){pArr[pArr[i].productcode] =  pArr[i];}}this.pArr=pArr;}else{alert('상품 정보가 없습니다.');}if(pArr[productcode].display=='N'){alert('품절된 상품입니다.');if(this.device=='M'){history.back(-1);}return'SOLDOUT';}var season_eng_name=pArr[productcode].season_eng_name;if(season_eng_name==''){season_eng_name='season코드없음';}this.pridx=this.pArr[productcode].pridx;if(pArr[productcode].join_yn=='Y'){this.join_type=true;var joinproductArr=pArr[productcode].join_productcode.split('^');var joinproductArr0=joinproductArr[0].split('|');var joinproductArr1=joinproductArr[1].split('|');var joinproductParam='';for(var i=0;i<joinproductArr0.length;i++){joinproductParam+="'"+joinproductArr0[i]+"',";}joinproductParam=joinproductParam.substring(0,joinproductParam.length-1);var data=db.getDBFunc({sp_name:'joinproduct_sellprice',sp_param:joinproductParam});var sellprice=comma(data.data[0].sellprice);var consumerprice=comma(data.data[0].consumerprice);var rows='';for(var i=0;i<joinproductArr0.length;i++){rows+='<div class="opt-size-wrap">';rows+='	<p class="set-goods-nm" id="join_product_name'+i+'">'+joinproductArr1[i]+'</p>';rows+='	<div class="opt-size" id="join-opt-zone'+i+'">';rows+='	</div>';rows+='</div>';}var joinproduct='';$('#join_product_area').html(rows);var data=db.getDBFunc({sp_name:'joinproduct_detail_option',sp_param:joinproductParam});poArr=data.data;if(poArr){}else{alert('결합상품 옵션 정보가 없습니다.');}for(var i=0;i<joinproductArr0.length;i++){var rows="";for(var j=0;j<poArr.length;j++){if(joinproductArr0[i]==poArr[j].productcode){if(gubun=='M'){rows+='<label><input type="radio" name="selectSize"  onclick="product.getQuantity(0,\''+poArr[i].productcode+'\',\''+poArr[i].option_code+'\')"><span>'+poArr[i].option_code+'</span></label>';}else{rows+='<div><input type="radio" name="optSize'+i+'" id="size'+i+poArr[j].option_code+'" value="'+poArr[j].option_code+'" > ';rows+='	<label for="size'+i+poArr[j].option_code+'" onclick="product.getQuantity('+i+',\''+poArr[j].productcode+'\',\''+poArr[j].option_code+'\')">'+poArr[j].option_code+'</label>';rows+='</div> ';}}}$('#join-opt-zone'+i).html(rows);}$('.o2o_radio').hide();$('#join_product_area').show();}else{var data=db.getDBFunc({sp_name:'product_detail_option',sp_param:prodcode});poArr=data.data;if(poArr){}else{alert('상품 옵션 정보가 없습니다.');}var rows="";for(var i=0;i<poArr.length;i++){if(poArr[i].productcode==productcode){var quantity_disabled="";if(poArr[i].option_quantity=='0'){quantity_disabled="disabled";}if(gubun=='M'){if(poArr[i].option_quantity=='0'){rows+='<label><input type="radio" name="selectSize"  disabled onclick="alert(\'품절된 상품입니다.\');" ><span>'+poArr[i].option_code+'</span></label>';}else{rows+='<label><input type="radio" name="selectSize"  onclick="product.getQuantity(0,\''+poArr[i].productcode+'\',\''+poArr[i].option_code+'\')" ><span>'+poArr[i].option_code+'</span></label>';}}else{rows+='<div>';if(poArr[i].option_quantity=='0'){rows+='<input type="radio" value="'+poArr[i].option_code+'" disabled> ';rows+='	<label for="size'+poArr[i].option_code+'" onclick="alert(\'품절된 상품입니다.\')">'+poArr[i].option_code+'</label>';}else{rows+='<input type="radio" name="optSize" id="size'+poArr[i].option_code+'" value="'+poArr[i].option_code+'" > ';rows+='	<label for="size'+poArr[i].option_code+'" onclick="product.getQuantity(0,\''+poArr[i].productcode+'\',\''+poArr[i].option_code+'\')">'+poArr[i].option_code+'</label>';}rows+='</div> ';}}}var opt_zone=rows;}var param=[prodcode];var data=db.getDBFunc({sp_name:'like_cnt',sp_param:param});var like_cnt=data.data[0].total_cnt;var param=[this.sessid,prodcode];var data=db.getDBFunc({sp_name:'like_check',sp_param:param});var like_my_cnt=data.data[0].total_cnt;var maximage=pArr[productcode].maximage;var minimage=pArr[productcode].minimage;var tinyimage=pArr[productcode].tinyimage;var main_content=pArr[productcode].content;var pr_content=pArr[productcode].pr_content;var prop_option=pArr[productcode].sabangnet_prop_option;var prop_val=pArr[productcode].sabangnet_prop_val;var data=db.getDBFunc({sp_name:'product_multiimages',sp_param:prodcode});pmiArr=data.data;if(pmiArr){}else{alert('상품 멀티 이미지 정보가 없습니다.');}ret={'pArr':this.pArr,'season_eng_name':season_eng_name,'join_yn':pArr[productcode].join_yn,'sellprice':sellprice,'consumerprice':consumerprice,'joinproduct':joinproduct,'opt_zone':opt_zone,'like_cnt':like_cnt,'like_my_cnt':like_my_cnt,'maximage':maximage,'minimage':minimage,'tinyimage':tinyimage,'main_content':main_content,'prop_option':prop_option,'prop_val':prop_val,'pr_content':pr_content,'pmiArr':pmiArr,'poArr':poArr,}
return ret;};this.getQuantity=function(e,productcode,size){$('#size'+size).prop('checked',true);for(var i=0;i<poArr.length;i++){if(poArr[i].productcode==productcode){if(poArr[i].option_code==size){$('#quantity_max').val(poArr[i].option_quantity);this.quantity_max=poArr[i].option_quantity;}}}this.setBasket(e,productcode,size);};this.product_discount_rate=function(bridx,st_per){var param=[bridx,st_per,st_per];var data=db.getDBFunc({sp_name:'product_discount_rate',sp_param:param});var ins_per=data.data[0].ins_per;return ins_per;};this.setBasket=function(e,productcode,size){this.basketArr[e]={'productcode':productcode,'size':size};};this.setQntPlus=function(){var qnty=Number($('#quantity').val());qnty+=1;this.quantity=qnty;if(!this.join_type){var qmax=$('#quantity_max').val();if(!qmax){alert('사이즈를 선택해 주세요');return false;}if(qnty>qmax){alert('구매가능한 재고는 '+qmax+'개 입니다.');return false;}}$('#quantity').val(qnty);var sum_price=Number($("#sellprice").val()*qnty);$("#sellprice_txt").text("￦"+comma(sum_price));};this.setQntMinus=function(){var qnty=Number($('#quantity').val());qnty-=1;this.quantity=qnty;if(qnty>0){$('#quantity').val(qnty);var sum_price=Number($("#sellprice").val()*qnty);$("#sellprice_txt").text("￦"+comma(sum_price));}}
this.mdChoise=function(gubun){var data=db.getDBFunc({sp_name:'product_md_choise',sp_param:pArr[req.productcode].brandcd});var type=0;var productcodes='';if(!req.code){req.code=req.productcode.substring(0,9)+'000';}if(data.data[0].mdchoise==''){var req_code=req.code.substring(0,6);data=db.getDBFunc({sp_name:'product_md_choise_product_alt',sp_param:req_code});list=data.data;for(var i=0;i<list.length;i++){productcodes+=list[i].productcode+",";}type=1;}if(data.data){var mdchois='';if(type==0){mdchoise=data.data[0].mdchoise;}else{mdchoise=productcodes;}var mdchoiseArr=mdchoise.split(',');var mdchoiseStr='';for(var i=0;i<mdchoiseArr.length;i++){mdchoiseStr+="'"+mdchoiseArr[i]+"',";}mdchoiseStr=mdchoiseStr.substring(0,(mdchoiseStr.length-1));var opt=db.getDBFunc({sp_name:'event_tab_group_product_opt',sp_param:mdchoiseStr});opt=opt.data;var param=[sessid,mdchoiseStr];var data=db.getDBFunc({sp_name:'product_md_choise_product',sp_param:param});var list=data.data;if(!list){var req_code=req.code.substring(0,6);var param=[req_code];data=db.getDBFunc({sp_name:'product_md_choise_product_alt',sp_param:param});list=data.data;}var rows='';if(data.data){for(var i=0;i<list.length;i++){var imgdir='';if(list[i].tinyimage.indexOf('http')==-1){imgdir='/data/shopimages/product/';}if(gubun=='M'){rows+='<li>';rows+='	<a href="?productcode='+list[i].productcode+'&code='+req.code+'">';rows+='		<figure>';rows+='			<div class="img"><img src="'+imgdir+list[i].tinyimage+'" alt="상품 이미지"></div>';rows+='			<figcaption>';rows+='				<p class="name">'+list[i].productname+'</p>';rows+='				<p class="price">￦ '+comma(list[i].sellprice)+'</p>';rows+='			</figcaption>';rows+='		</figure>';rows+='	</a>';rows+='</li>';}else{rows+='<li>';rows+='<div class="goods-item">';rows+='	<div class="thumb-img">';rows+='		<a href="?productcode='+list[i].productcode+'&code='+req.code+'"><img src="'+imgdir+list[i].tinyimage+'" alt="상품 썸네일"></a>';rows+='		<div class="layer">';rows+='			<div class="btn">';rows+='				<button type="button" class="btn-preview"><span><a href="?productcode='+list[i].productcode+'&code='+req.code+'"><i class="icon-cart">장바구니</i></a></span></button>';if(list[i].likeme==1){likeClass='icon-dark-like';}else{likeClass='icon-like';}rows+='				<button type="button"	<span><i id="like_m'+i+'" class="'+likeClass+'" onclick="like.clickLike(\'product\',\'m'+i+'\',\''+list[i].productcode+'\')">좋아요</i></span><span id="like_cnt_m'+i+'" >'+list[i].likecnt+'</span></button>';rows+='			</div>';rows+='			<div class="opt">';for(var j=0;j<opt.length;j++){if(opt[j].productcode==list[i].productcode){rows+='	<span>'+opt[j].option_code+'</span>';}}rows+='			</div>';rows+='		</div>';rows+='	</div>';rows+='	<div class="price-box">';rows+='		<div class="brand-nm">'+list[i].production+'</div>';rows+='		<div class="goods-nm">'+list[i].productname+'</div>';rows+='		<div class="price">￦'+comma(list[i].sellprice)+'</div>';rows+='		</div>';rows+='	</div>';rows+='</li>';if(i>=3){break;}}}}$('#mdchoise').html(rows);if(mdchoise==''){}}else{$('#mdchoise_div').hide();}};this.categorybest=function(gubun){if(!req.code){req.code=req.productcode.substring(0,9)+'000';}if(req.code){var category='';if(req.code.substring(6,12)=='000000'){category=req.code.substring(0,6);}else if(req.code.substring(9,12)=='000'){category=req.code.substring(0,9);}else{category=req.code;}var param=[sessid,category];var data=db.getDBFunc({sp_name:'product_category_best',sp_param:param});if(data.data){var list=data.data;var rows='';for(var i=0;i<list.length;i++){var imgdir='';if(list[i].tinyimage.indexOf('http')==-1){imgdir='/data/shopimages/product/';}if(gubun=='M'){rows+='<li>';rows+='	<a href="?productcode='+list[i].productcode+'&code='+req.code+'">';rows+='		<figure>';rows+='			<div class="img"><img src="'+imgdir+list[i].tinyimage+'" alt="상품 이미지"></div>';rows+='			<figcaption>';rows+='				<p class="name">'+list[i].productname+'</p>';rows+='				<p class="price">￦ '+comma(list[i].sellprice)+'</p>';rows+='			</figcaption>';rows+='		</figure>';rows+='	</a>';rows+='</li>';}else{rows+='<li>';rows+='<div class="goods-item">';rows+='	<div class="thumb-img">';rows+='		<a href="?productcode='+list[i].productcode+'&code='+req.code+'"><img src="'+imgdir+list[i].tinyimage+'" alt="상품 썸네일"></a>';rows+='		<div class="layer">';rows+='			<div class="btn">';rows+='				<button type="button" class="btn-preview"><span><a href="?productcode='+list[i].productcode+'&code='+req.code+'"><i class="icon-cart">장바구니</i></a></span></button>';if(list[i].likeme==1){likeClass='icon-dark-like';}else{likeClass='icon-like';}rows+='				<button type="button"	<span><i id="like_b'+i+'" class="'+likeClass+'" onclick="like.clickLike(\'product\',\'b'+i+'\',\''+list[i].productcode+'\')">좋아요</i></span><span id="like_cnt_b'+i+'" >'+list[i].likecnt+'</span></button>';rows+='			</div>';rows+='			<div class="opt">';rows+='			</div>';rows+='		</div>';rows+='	</div>';rows+='	<div class="price-box">';rows+='		<div class="brand-nm">'+list[i].production+'</div>';rows+='		<div class="goods-nm">'+list[i].productname+'</div>';rows+='		<div class="price">￦'+comma(list[i].sellprice)+'</div>';rows+='		</div>';rows+='	</div>';rows+='</li>';}}$('#categorybest').html(rows);}else{$('#categorybest_div').hide();}}else{$('#categorybest_div').hide();}};this.basketInsert=function(type,gubun){var joingrpidx='';var delivery_type=$('[name="delivery_type"]:checked').val();var sellprice=$('#sellprice').val();if(!delivery_type){delivery_type=0;}var quantity=$('#quantity').val();if(this.basketArr.length==0){alert('사이즈를 선택해 주세요 ');return false;}if(delivery_type=='1'){if(quantity>1){var rtmsg='매장픽업의 경우 수량은 1개만 가능합니다. \n수정하여 장바구니에 담으시겠습니까?';if(type=='direct'){rtmsg='매장픽업의 경우 수량은 1개만 가능합니다. \n수정하여 주문 하시겠습니까?';}if(confirm('')){$('#quantity').val(1);quantity=1;}else{return false;}}if($('#mapSelectStore1').val()==''){alert('매장을 선택해 주세요');getShopO2O(1);return false;}if($('#mapSelectStoreName1').html()==''){alert('매장을 선택해 주세요');return false;}}if(delivery_type=='3'){if(quantity>1){var rtmsg='당일수령의 경우 수량은 1개만 가능합니다. \n수정하여 장바구니에 담으시겠습니까?';if(type=='direct'){rtmsg='당일수령의 경우 수량은 1개만 가능합니다. \n수정하여 주문 하시겠습니까?';}if(confirm(rtmsg)){$('#quantity').val(1);quantity=1;}else{return false;}}if($('#mapSelectStore2').val()==''){alert('매장을 선택해 주세요');getShopO2O(3);return false;}if($('#basong_price').html()==''){alert('매장을 선택해 주세요');getShopO2O(3);return false;}if($('#mapSelectStoreName2').html()=='당일수령은 서울지역만 가능합니다.'){alert('매장을 선택해 주세요');return false;}}if(this.basketArr[0].productcode!=''){for(var i=0;i<this.basketArr.length;i++){var productcode=this.basketArr[i].productcode;var option_code=this.basketArr[i].size;var option_type=0;if(!option_code){alert('결합상품 사이즈를 선택해 주세요');return false;}var sp_param=productcode+'|'+option_code+'|'+this.sessid+'|'+this.tempkey+'|'+delivery_type;var data=db.getDBFunc({sp_name:'basket_grpidx_check',sp_param:sp_param});var basketgrpidx=''
if(data.data){basketgrpidx=data.data[0].basketgrpidx;db.setDBFunc({sp_name:'delete_basket',sp_param:basketgrpidx});}if(basketgrpidx==''){var data=db.getDBFunc({sp_name:'basket_grpidx',sp_param:''});var grpidx=data.data[0].basket_grpidx;}else{var grpidx=basketgrpidx;}var choiseday=$('#choiseday').val();if(!choiseday)choiseday='';var post_code=$('#post_code').val();if(!post_code)post_code='';var address1=$('#address1').val();if(!address1)address1='';var address2=$('#address2').val();if(!address2)address2='';var gps_x=$('#lat').val();if(!gps_x)gps_x='';var gps_y=$('#lng').val();if(!gps_y)gps_y='';var delivery_price=uncomma($('#basong_price').html());if(delivery_price=='0')delivery_price='';var data='';var store_code=$('#mapSelectStore').val();var sp_param=[this.tempkey,productcode,this.vdate,delivery_type,this.sessid,option_code,1,'SIZE',option_code,grpidx,store_code,choiseday,post_code,address1,address2,gps_x,gps_y,delivery_price];for(var j=0;j<quantity;j++){data=db.setDBFunc({sp_name:'basket_insert',sp_param:sp_param});}}fbq('track','AddToCart',{value:Number(sellprice),currency:'KRW'});joingrpidx="'"+grpidx+"',"+joingrpidx;}else{alert('사이즈를 선택해 주세요 ');return false;}if(type=='direct'){joingrpidx=joingrpidx.substring(0,joingrpidx.length-1);var data=db.getDBFunc({sp_name:'basket_select_basketidx',sp_param:joingrpidx});var ordbasketidArr=data.data;var ordbasketid='';if(ordbasketidArr){for(var i=0;i<ordbasketidArr.length;i++){ordbasketid+=ordbasketidArr[i].basketidx+'|';}ordbasketid=ordbasketid.substring(0,ordbasketid.length-1);}if(sessid==''){if(this.device=='M'){location.href='/m/login.php?chUrl=/m/order.php?basketidxs='+ordbasketid;}else{location.href='/front/login.php?chUrl=/front/order.php?basketidxs='+ordbasketid;}return false;}$('#basketidxs').val(ordbasketid);$("#orderfrm").submit();}else{if(data){if(data.code){if(confirm("장바구니에 추가되었습니다.\n장바구니로 이동하시겠습니까?")){if(gubun=='M'){location.href="../m/basket.php";}else{location.href="../front/basket.php";}}}else{alert('장바구니 저장시 오류가 발생했습니다.');}}else{alert('사이즈를 선택해 주세요.');}}};}